Ich habe ein Bash-Script `scripts/extract-gfx906-patches.sh` erstellt, das deine gfx906-Änderungen nach den 8 Kategorien aus `plans/Optimierung.md` extrahiert - inklusive aller zusätzlichen Änderungen aus den Dev-Protokollen.

## Was das Script extrahiert:

### Kategorie A - gfx906 Kernel (neue Dateien)
- `gfx906-common.cuh`, `gfx906-config.h`
- `gfx906-fattn-q8.cuh/cu` (Flash Attention Q8)
- `gfx906-mmq*.cuh` (MMQ Optimierungen)
- `gfx906-mmvq-q4_0.cuh`, `q4_1.cuh`, `q5_k.cuh`, `q8_0.cuh` (Warp-cooperative MMVQ)
- `gfx906-vecdotq.cuh` (MXFP4 Optimierungen)
- Template-Instanzen unter `gfx906/template-instances/`

### Kategorie B - Dispatch (`mmvq.cu`)
- Guarded Includes für GFX906
- Dispatch-Logik für Q4_0, Q4_1, Q5_K, Q8_0

### Kategorie C - Flash Attention (`fattn.cu`, `fattn-common.cuh`)
- AMD-spezifische Reduktionspfade (DPP)
- Split-K Clamp für PP vs TG
- gfx906 Q8 Flash Attention Integration

### Kategorie D - Q8/MXFP4 Pipeline (`mmq.cuh`, `vecdotq.cuh`)
- Software-Pipelining für Q8_0
- Prefetching (`gfx906_prefetch_y_tile_v4`)
- Optimierter MXFP4 Dequant (`v_perm_b32`)

### Kategorie E - Wave64/MoE Fix (`mmid.cu`, `mmq.cu`)
- HIP-Wave64-Fallback für `n_expert_used >= warp_size/2`
- s13 Stride Korrektur in `mmq.cu`

### Kategorie F - DPP Warp Utils (`common.cuh`, `ggml-cuda.cu`)
- `ggml_cuda_shfl_xor_sync` Helper
- DPP-basierte Warp-Reduktionen
- Fast-Path für `ggml_cuda_e8m0_to_fp32`

### Kategorie G - Build-System (CMake)
- `ggml/src/ggml-cuda/CMakeLists.txt`
- `ggml/src/ggml-hip/CMakeLists.txt`

### Kategorie H - Tooling/Scripts
- `SCRIPT_*.sh` Dateien (falls vorhanden)

## Verwendung:

```bash
# 1. BASELINE_COMMIT setzen (optional, sonst HEAD~10)
export BASELINE_COMMIT="b7871"  # oder dein Start-Commit

# 2. Script ausführen
cd /home/pat/Dokumente/GitHub/llama-mi50/llama-mi50.cpp
chmod +x scripts/extract-gfx906-patches.sh
./scripts/extract-gfx906-patches.sh

# 3. Patches werden in ./patches/ gespeichert
```

## Auf neue llama.cpp Version anwenden:

```bash
cd /pfad/zu/neuem/llama.cpp
git checkout -b gfx906-port

# Reihenfolge beachten (F → C → E → G → A → B → D):
for p in F C E G A B D; do
    git apply --3way patches/${p}-*.patch || echo "Konflikt in ${p}"
done

# Bei Konflikten:
git apply --reject patches/A-gfx906-kernels.patch
# .rej Dateien manuell bearbeiten
```

Die zusätzlichen Änderungen aus den Dev-Protokollen (Q5_K Kernel, CMake Statusmeldungen, etc.) sind bereits in den Kategorien A, B und G enthalten.

---
